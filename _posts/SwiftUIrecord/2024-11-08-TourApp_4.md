---
title: TourApp (4)
writer: Harold
date: 2024-11-08 7:33:00 +0800
categories: [Study, TourApp]
tags: []

toc: true
toc_sticky: true
---

### json ì ìš©í•˜ê¸°

ìš°ì„  json ì–‘ì‹ìœ¼ë¡œ íŒŒì¼ì„ ë°”ê¿”ì¤€ë‹¤.

ì´ë•Œ ì´ì „ê³¼ íŠ¹ì´ì ì´ë¼ë©´ json ë¡œë“œê°€ from serverê°€ ì•„ë‹Œ from localì´ë¼ëŠ”ê²ƒ.

#### ëª¨ë¸ë§

ëª¨ë¸ë§ì„ í•´ì¤€ë‹¤.

```swift
struct JsonModel: Codable {
    let tours: [Tour]
}

// MARK: - Tour
struct Tour: Codable {
    let title: String
    let imageURL: String
    let description, address: String
    let latitude, longitude: Double
    let resList: [ResList]

    enum CodingKeys: String, CodingKey {
        case title
        case imageURL = "imageUrl"
        case description, address, latitude, longitude, resList
    }
}

// MARK: - ResList
struct ResList: Codable {
    let imageURL: String
    let shopTitle: String
    let shopURL: String

    enum CodingKeys: String, CodingKey {
        case imageURL = "imageUrl"
        case shopTitle
        case shopURL = "shopUrl"
    }
}
```

ì‚¬ì‹¤ ëª¨ë¸ë§ì€ [ì‚¬ì´íŠ¸](https://app.quicktype.io/){:target="_blank"}ë¥¼ í†µí•´ì„œ í•˜ëŠ”ê²Œ ì œì¼ ë¹ ë¥´ê¸´ í•˜ë‹¤.

#### json load í•¨ìˆ˜ ë§Œë“¤ê¸°.

ì—¬ëŸ¬ ìë£Œë¥¼ ì°¾ì•„ë³´ì•˜ëŠ”ë° `UrlSession`ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì™€ ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ë‘ê°€ì§€ê°€ ìˆì—ˆëŠ”ë°

urlsessionì„ ì‚¬ìš©í•œ ìë£ŒëŠ” 4ë…„ ì „ì´ê³  ê·¼ë˜ ìë£Œë“¤ì€ ê·¸ëƒ¥ ë¡œë“œë¥¼ í•˜ëŠ”ë“¯ í•˜ë‹¤.

ê¸°ë³¸ë¼ˆëŒ€ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```swift
class loadJsonModel: ObservableObject {
    @Published var json = [JsonModel]()
    
    init() {
        load()
    }
    
    func load() {
        
    }
}
```

##### Without Urlsession

[Youtube](https://www.youtube.com/watch?v=G9vXr41ssdM){:target="_blank"} ë¥¼ ì°¸ê³ í•˜ì˜€ë‹¤.

```swift
class loadJsonModel: ObservableObject {
    @Published var tours = [JsonModel]()
    
    init() {
        load()
    }
    
    func load() {
        guard let url = Bundle.main.url(forResource: "data", withExtension: "json")
        else {
            print("Json file not found")
            return
        }
      
        let data = (try? Data(contentsOf: url))!
        let tours = try? JSONDecoder().decode([JsonModel].self, from: data)
        
        self.tours = tours!
    }
}
```

ì´í›„ listviewë¥¼ ìˆ˜ì •

```swift
struct ListView: View {
    
    @ObservedObject var json = loadJsonModel()
    
    var body: some View {
        NavigationStack {
            Text("ê´€ê´‘ ê³ ê³ ")
                List {
                    ForEach(json.tours, id: \.self) { tour in
                        NavigationLink(value: tour) {
                            CellView(title: tour.title, imageUrl: tour.imageUrl)
                        }
                    }
                }
            .navigationDestination(for: TourModel.self) { model in
                DetailView(title: model.title, imageUrl: model.imageUrl, description: model.description, address: model.address, coordinate: CLLocationCoordinate2D(latitude: model.latitude, longitude: model.longitude), shopList: model.resList, cameraPosition: .camera(MapCamera(centerCoordinate: CLLocationCoordinate2D(latitude: model.latitude, longitude: model.longitude), distance: 1000, heading: 90, pitch: 80)))
            }
        }
        
    }
}
```

í•˜ì§€ë§Œ ì—ëŸ¬ê°€ ë°œìƒ

```text
Cannot convert value of type '[JsonModel]' to expected argument type 'Binding<C>'
```

jsonì—ì„œ ì˜ëª»ëœê±¸ ë°œê²¬

```swift
@Published var tours = [Tour]() // ìˆ˜ì •

let decodedData = try? JSONDecoder().decode(JsonModel.self, from: data) // ìˆ˜ì •
        
self.tours = decodedData!.tours // ìˆ˜ì •
```

ê·¸ë¬ë”ë‹ˆ

```text
Generic struct 'ForEach' requires that 'loadJsonModel' conform to 'RandomAccessCollection'
```

ì—ëŸ¬ë°œìƒ

ìˆ˜ì •ì„ í•˜ë˜ ë„ì¤‘ hashable í”„ë¡œí† ì½œì´ í•„ìš”í•˜ë‹¤ê³  ì—ëŸ¬ê°€ ë°œìƒ.

í˜„ì¬ëŠ” idê°€ ì—†ë‹¤.

ê·¸ë˜ì„œ UUIDë¥¼ ì‚¬ìš©í•˜ì—¬ idë¥¼ ë¶€ì—¬í•œë‹¤

```swift
struct Tour: Codable, Hashable {

    let id = UUID()
    let title: String
    let imageURL: String
    let description, address: String
    let latitude, longitude: Double
    let resList: [ResList]
    
    enum CodingKeys: String, CodingKey {
        case title
        case imageURL = "imageUrl"
        case description, address, latitude, longitude, resList
    }
}
```

Generic ê´€ë ¨ ì—ëŸ¬ê°€ ë‚œë‹¤.

```swift
struct PageView: View {
    
    var lists = [ResList]()
    
    @State private var currentPage: Int = 0
    
    var body: some View {
        VStack(spacing: 20) {
            TabView(selection: $currentPage.animation()) {
                ForEach(0..<lists.count, id: \.self) { index in
                        VStack {
                            AsyncImage(url: URL(string: lists[index].imageURL)) { image in
                                image
                                    .resizable()
                                    .frame(maxWidth: 150, maxHeight: 150)
                            } placeholder: {
                                Image(systemName: "photo")
                            }
                            Link(destination: URL(string: lists[index].shopUrl)!) { Text(lists[index].shopTitle)
                                    .fontWeight(.bold)
                                    .foregroundStyle(.blue)
                        }
                    }
                }
            }
```

ë°”ë¡œ ForEach ë¶€ë¶„ì—ì„œ Errorê°€ ë°œìƒ

ë¯¸ì™„ì¸ì±„ë¡œ ê°™ì´ ê³µë¶€ë¥¼ í•˜ë˜ ë¶„ê³¼ íšŒê³ ë¥¼ í•˜ë˜ ë„ì¤‘ ë¹„ìŠ·í•œ ì—ëŸ¬ë¥¼ ê²ªìœ¼ì…¨ë‹¤ê³  í•˜ì—¬, `@State var lists = [ResList]()` ë¡œ ë°”ì¸ë”©ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì—¬ ì ìš©ì„ í•´ë³´ë ¤ í•œë‹¤.

ê·¸ë ‡ê²Œ í•˜ë‹ˆ ì´ë²ˆì—”

`AsyncImage(url: URL(string: list.imageURL)) { image in` ì—¬ê¸°ì„œ ì—ëŸ¬ê°€ ë°œìƒ

```text
Cannot convert value of type 'Binding<String>' to expected argument type 'String'
```

bindingStringì´ë¼ ìƒê¸°ëŠ” ë¬¸ì œì¸ë“¯í•˜ë‹¤.

`AsyncImage(url: URL(string: list.wrappedValue.imageURL))`

bindingStringì„ stringì„ ì‚¬ìš©í• ë•ŒëŠ” wrappedValueë¥¼ ì‚¬ìš©í•œë‹¤.

### ğŸ“˜ Swiftì˜ `wrappedValue` ì´í•´í•˜ê¸°

#### ğŸ“ ì •ì˜
- **`wrappedValue`**ëŠ” **Swiftì˜ í”„ë¡œí¼í‹° ë˜í¼(Property Wrapper)**ì—ì„œ ì›ë˜ ê°’ì„ ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì†ì„±ì´ë‹¤.
- `@State`, `@Binding`, `@Published` ë“±ì˜ í”„ë¡œí¼í‹° ë˜í¼ëŠ” ë‚´ë¶€ ê°’ì„ ê°ì‹¸ê³  ìˆìœ¼ë©°, ì´ ê°’ì„ ì½ê±°ë‚˜ ìˆ˜ì •í•  ë•Œ `wrappedValue`ë¥¼ ì‚¬ìš©í•œë‹¤.

#### ğŸ” ì£¼ìš” íŠ¹ì§•
- **í”„ë¡œí¼í‹° ë˜í¼ì˜ ì‹¤ì œ ê°’**ì„ ë°˜í™˜í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.
- SwiftUIì—ì„œëŠ” `$`ë¥¼ ì‚¬ìš©í•˜ì—¬ `wrappedValue`ì— ê°„ë‹¨í•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `$count`ëŠ” `count.wrappedValue`ì™€ ë™ì¼í•˜ë‹¤.
- ì£¼ë¡œ SwiftUIì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ë§Œ, ëª…ì‹œì ìœ¼ë¡œ ê°’ì„ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ ë•Œ `wrappedValue`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ

##### 1ï¸âƒ£ ê¸°ë³¸ ì‚¬ìš© ì˜ˆì‹œ

```swift
import SwiftUI

struct ContentView: View {
    @State private var count: Int = 0

    var body: some View {
        VStack {
            Text("Count: \(count)") // ì›ë˜ ê°’ ì‚¬ìš©
            Text("Wrapped Count: \($count.wrappedValue)") // wrappedValueë¡œ ì ‘ê·¼

            Button("Increment") {
                $count.wrappedValue += 1 // wrappedValueë¥¼ ì‚¬ìš©í•˜ì—¬ ê°’ ìˆ˜ì •
            }
        }
    }
}
```

ì„¤ëª…:
- @StateëŠ” SwiftUIì—ì„œ ê°’ì˜ ë³€í™”ë¥¼ ì¶”ì í•˜ê³  ë·°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.
- $countëŠ” countì˜ Bindingì„ ë‚˜íƒ€ë‚´ë©°, .wrappedValueë¥¼ í†µí•´ ì›ë˜ ê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

##### 2ï¸âƒ£ @Bindingê³¼ wrappedValue ì˜ˆì‹œ

```swift
import SwiftUI

struct ParentView: View {
    @State private var name: String = "Swift"

    var body: some View {
        ChildView(text: $name)
    }
}

struct ChildView: View {
    @Binding var text: String

    var body: some View {
        VStack {
            Text("Wrapped Value: \(text.wrappedValue)") // Bindingì˜ wrappedValue ì‚¬ìš©
            TextField("Enter Name", text: $text)
        }
    }
}
```

ì„¤ëª…:
- ParentViewì—ì„œ $nameì„ ì „ë‹¬í•˜ë©´ ChildViewì—ì„œ @Bindingì„ í†µí•´ ê°’ì„ ë°›ëŠ”ë‹¤.
- text.wrappedValueëŠ” @Bindingì˜ ì›ë˜ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.

#### âœ… ê²°ë¡ 

- **wrappedValue**ëŠ” í”„ë¡œí¼í‹° ë˜í¼ê°€ ê°ì‹¸ê³  ìˆëŠ” ì›ë˜ ê°’ì„ ë°˜í™˜í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.
- SwiftUIì—ì„œëŠ” $ë¥¼ í†µí•´ wrappedValueì— ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
- ì£¼ë¡œ SwiftUIì—ì„œ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ë§Œ, ëª…ì‹œì ìœ¼ë¡œ ì ‘ê·¼í•  ë•Œ wrappedValueë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---

í•˜ì§€ë§Œ ë¬¸ì œê°€ ë°œìƒ

ê·¸ë˜ì„œ í˜¹ì‹œë‚˜í•´ì„œ

```swift
ForEach(lists.indices, id: \.self) { index in
                        VStack {
                            AsyncImage(url: URL(string: lists[index].imageURL)) { image in
                                image
                                    .resizable()
                                    .frame(maxWidth: 150, maxHeight: 150)
                            } placeholder: {
                                Image(systemName: "photo")
                            }
                            Link(destination: URL(string: lists[index].shopURL)!) { Text(lists[index].shopTitle)
                                    .fontWeight(.bold)
                                    .foregroundStyle(.blue)
                        }
                    }
```

ì—¬ê¸°ë¥¼ ë‹¤ì‹œ ëŒë ¤ë´¤ëŠ”ë° ê°‘ìê¸° ëœë‹¤.

ì•ˆë˜ì—ˆë˜ ì´ìœ ë¥¼ ëª¨ë¥´ê² ë‹¤.