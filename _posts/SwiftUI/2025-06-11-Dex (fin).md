---
title: Dex (fin)
writer: Harold
date: 2025-6-11 7:33:00 +0800
categories: [Udemy, SwiftUI]
tags: [SwiftUI]

toc: true
toc_sticky: true
---

## Predicate ìˆ˜ì •

CoreDataì—ì„œ SwiftDataë¡œì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë§ˆì¹˜ë©° ê¸°ë³¸ì ì¸ êµ¬ì¡°ì™€ ë™ì‘ ì˜¤ë¥˜ëŠ” ëŒ€ë¶€ë¶„ í•´ê²°í–ˆë‹¤.
í•˜ì§€ë§Œ ì‹¤ì œ ì•±ì—ì„œ ë°ì´í„°ë¥¼ â€œì¡°ê±´ì— ë§ê²Œ í•„í„°ë§â€í•˜ëŠ” ê¸°ëŠ¥, ì¦‰ PredicateëŠ” ì•„ì§ ì†ëŒ€ì§€ ì•Šì€ ìƒíƒœì´ë‹¤.

ì´ë²ˆ ê¸€ì—ì„œëŠ” SwiftDataì—ì„œ predicateë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€, ê¸°ì¡´ ë°©ì‹ê³¼ ì–´ë–¤ ì°¨ì´ê°€ ìˆëŠ”ì§€ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì‚´í´ë³´ë©° ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ë§ˆë¬´ë¦¬í•´ë³¸ë‹¤.

---

### CoreData vs SwiftData: Predicate ë¹„êµ

#### CoreData ë°©ì‹

```swift
// CoreData ë°©ì‹  
private var dynamicPredicate: NSPredicate {  
    var predicates: [NSPredicate] = []  

    if !searchText.isEmpty {  
        predicates.append(NSPredicate(format: "name contains[c] %@", searchText))  
    }  

    if filterByFavorite {  
        predicates.append(NSPredicate(format: "favorite == %d", true))  
    }  

    return NSCompoundPredicate(andPredicateWithSubpredicates: predicates)  
}  

NavigationStack {  
    List {  
        Section {  
            ForEach(pokedex) // ê²°ê³¼ ìë™ í•„í„°ë§ ì•ˆ ë¨  
        }  
    }  
}  
```

> ë¬¸ìì—´ ê¸°ë°˜ formatìœ¼ë¡œ Predicateë¥¼ êµ¬ì„±í•´ì•¼ í•˜ë©°, íƒ€ì… ì•ˆì •ì„±(type-safety)ì´ ë–¨ì–´ì§€ê³  ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•¨.

---

#### SwiftData ë°©ì‹

```swift
// SwiftData ë°©ì‹  
private var dynamicPredicate: Predicate<Pokemon> {  
    #Predicate<Pokemon> { pokemon in  
        if filterByFavorite && !searchText.isEmpty {  
            pokemon.favorite && pokemon.name.localizedStandardContains(searchText)  
        } else if !searchText.isEmpty {  
            pokemon.name.localizedStandardContains(searchText)  
        } else if filterByFavorite {  
            pokemon.favorite  
        } else {  
            true  
        }  
    }  
}  

NavigationStack {  
    List {  
        Section {  
            ForEach((try? pokedex.filter(dynamicPredicate)) ?? pokedex)  
        }  
    }  
}  
```

> SwiftDataì˜ #PredicateëŠ” íƒ€ì… ì„¸ì´í”„í•˜ë©° ì½”ë“œ ë ˆë²¨ì—ì„œ ë…¼ë¦¬ ì¡°ê±´ì„ ì§ì ‘ ëª…ì‹œí•  ìˆ˜ ìˆë‹¤.  
> &&, || ë“±ì˜ Swift ì—°ì‚°ìë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ë³µì¡í•œ ì¡°ê±´ ì¡°í•©ë„ ì§ê´€ì ìœ¼ë¡œ í‘œí˜„ ê°€ëŠ¥í•˜ë©°, ê°€ë…ì„±ì´ ë†’ê³  ë””ë²„ê¹…ë„ í›¨ì”¬ ì‰½ë‹¤.

---

### ğŸ” ì¶”ê°€ ì°¸ê³  ìë£Œ

- SwiftData ê³µì‹ íŠœí† ë¦¬ì–¼  
  [SwiftData Tutorials](https://developer.apple.com/tutorials/app-dev-training/swiftdata-sorting-and-filtering){:target="_blank"}

- ìš°ë¦¬ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì•Œê³  ìˆëŠ” String.filter  
  [String.filter](https://developer.apple.com/documentation/swift/string/filter(_:)){:target="_blank"}

- Sequence í”„ë¡œí† ì½œì˜ filter (ì˜ˆì‹œ ì—†ìŒ)  
  [Sequence.filter](https://developer.apple.com/documentation/swift/sequence/filter(_:)-8li9y){:target="_blank"}

---

- ê°œì¸ì ì¸ ìƒê°
    - SwiftDataì˜ filterëŠ” Predicate ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ë©° throws ê°€ëŠ¥ì„±ì´ ìˆìŒ  
    - ë”°ë¼ì„œ ì‚¬ìš© ì‹œ try ë˜ëŠ” try?ê°€ í•„ìš”í•˜ë©°, ì‹¤íŒ¨ë¥¼ ëŒ€ë¹„í•´ ?? ì—°ì‚°ìë¡œ fallback ì²˜ë¦¬ ê°€ëŠ¥  
    - ì¼ë°˜ì ì¸ Sequence.filterì™€ëŠ” ì™„ì „íˆ ë‹¤ë¥¸ ë©”ì„œë“œì´ë¯€ë¡œ í˜¼ë™í•˜ì§€ ì•Šì•„ì•¼ í•¨

í–¥í›„ throws, rethrows, throwing closures ë“±ì— ëŒ€í•œ ë³„ë„ ì •ë¦¬ê°€ í•„ìš”í•´ë³´ì¸ë‹¤.

í•´ë‹¹ ë¶€ë¶„ì— ëŒ€í•´ ë³„ë„ ì •ë¦¬í•œê¸€ì€ ë‚˜ì¤‘ì— ë§í¬ë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•˜ëŠ”ê±¸ë¡œ...

---

### ì• ë‹ˆë©”ì´ì…˜ê³¼ UX ê°œì„ 

predicate ì¡°ê±´ì´ ë°”ë€” ë•Œë§ˆë‹¤ ë¦¬ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ì„ ë¶€ì—¬í•˜ì—¬ ë¶€ë“œëŸ¬ìš´ UXë¥¼ ì œê³µí•œë‹¤.

```swift
.autocorrectionDisabled()
.animation(.default, value: searchText)

ToolbarItem(placement: .navigationBarTrailing) {
    Button {
        withAnimation {
            filterByFavorite.toggle()
        }
    } label: {
        Label("Filter By Favorites", systemImage: filterByFavorite ? "star.fill" : "star")
    }
    .tint(.yellow)
}
```
---

### ìš”ì•½

- SwiftDataì—ì„œëŠ” `#Predicate<T>` êµ¬ë¬¸ì„ í†µí•´ íƒ€ì… ì•ˆì •ì„±ê³¼ ê°€ë…ì„± ë†’ì€ í•„í„°ë§ì´ ê°€ëŠ¥í•˜ë‹¤.
- CoreDataì—ì„œ ìì£¼ ë°œìƒí•˜ë˜ format ì˜¤ë¥˜, ë¬¸ìì—´ ì˜¤íƒˆì ë¬¸ì œì—ì„œ ììœ ë¡­ë‹¤.
- `ForEach(pokedex.filter(predicate))` í˜•íƒœë¡œ ê²°ê³¼ë¥¼ ì•ˆì „í•˜ê²Œ í•„í„°ë§í•  ìˆ˜ ìˆë‹¤.
- ë™ì  í•„í„°ë§ ì‹œì—ëŠ” `.animation()` ë˜ëŠ” `withAnimation {}`ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë·° ë³€í™”ë¥¼ ì—°ì¶œí•  ìˆ˜ ìˆë‹¤.

## Widget ìˆ˜ì •í•˜ê¸°

ì´ì „ì— ì•± ì‹¤í–‰ì´ ìš°ì„ ì´ë¼ ìœ„ì ¯ë¶€ë¶„ì„ ì „ë¶€ ì£¼ì„ì²˜ë¦¬í–ˆëŠ”ë° ì´ì œëŠ” ì´ ë¶€ë¶„ì„ ë§ˆë¬´ë¦¬ ì§€ìœ¼ë ¤í•œë‹¤.

### Provider ìˆ˜ì •

#### sharedModelContainer ì •ì˜

```swift
var sharedModelContainer: ModelContainer = {
    let schema = Schema([
        Pokemon.self,
    ])
    let modelConfiguration = ModelConfiguration(
        schema: schema,
        isStoredInMemoryOnly: false
    )

    do {
        return try ModelContainer(
            for: schema,
            configurations: [modelConfiguration]
        )
    } catch {
        fatalError("Could not create ModelContainer: \(error)")
    }
}()
```

> SwiftDataëŠ” SwiftUI Viewì—ì„œì˜ ì‚¬ìš©ì„ ì „ì œë¡œ ì„¤ê³„ë˜ì—ˆê¸° ë•Œë¬¸ì—, View ì™¸ë¶€ì¸ `TimelineProvider`ì—ì„œ ì‚¬ìš©í•  ê²½ìš° ì§ì ‘ ModelContainerë¥¼ êµ¬ì„±í•´ ì£¼ì…í•´ì•¼ í•œë‹¤.  

---

#### getTimeline í•¨ìˆ˜ ìˆ˜ì •

```swift
func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
    Task { @MainActor in
        var entries: [SimpleEntry] = []
        
        let currentDate = Date()
        
        if let results = try? sharedModelContainer.mainContext.fetch(FetchDescriptor<Pokemon>()) {
            for hourOffset in 0..<10 {
                let date = Calendar.current.date(byAdding: .second, value: hourOffset * 5, to: currentDate)!
                let pokemon = results.randomElement()!
                let entry = SimpleEntry(
                    date: date,
                    name: pokemon.name,
                    types: pokemon.types,
                    sprite: pokemon.spriteImage
                )
                entries.append(entry)
            }
            
            let timeline = Timeline(entries: entries, policy: .atEnd)
            completion(timeline)
        } else {
            let timeline = Timeline(entries: [SimpleEntry.placeholder, SimpleEntry.placeholder2], policy: .atEnd)
            completion(timeline)
        }
    }
}
```

- @MainActorê°€ í•„ìš”í•œ ì´ìœ : mainContextëŠ” MainActorì— ë°”ì¸ë”©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, í•´ë‹¹ fetch ì‘ì—…ì€ MainActorì—ì„œ ìˆ˜í–‰ë˜ì–´ì•¼ í•œë‹¤.
- Taskë¡œ ê°ì‹¸ëŠ” ì´ìœ : getTimelineì€ ë™ê¸° í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ ì„ ì–¸ë¶€ì— @MainActorë¥¼ ë¶™ì¼ ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ë‚´ë¶€ì—ì„œ `Task { @MainActor in ... }`ë¡œ ëª…ì‹œì ì¸ ë©”ì¸ ì•¡í„° ì»¨í…ìŠ¤íŠ¸ë¥¼ í™•ë³´í•œë‹¤.
- fetchê°€ ì‹¤íŒ¨í•˜ë©´ else ë¸”ëŸ­ì—ì„œ placeholderë¡œ ëŒ€ì²´í•œë‹¤.

ë‚´ê°€ ì´í•´í•œë¶€ë¶„ì— ëŒ€í•´ ê°•ì‚¬ì—ê²Œ ë¬¼ì–´ë³´ë‹ˆ
>â€œYes, youâ€™re right again. We need that portion of the code to be on the main actor but if we put @MainActor outside of the function it will break other stuff, so we do it inside the function instead, which requires us to do Task.â€

ì´ë ‡ê²Œ ëŒ€ë‹µì´ ì™”ì—ˆë‹¤.

ì¦‰, í•¨ìˆ˜ ì™¸ë¶€ì— @MainActorë¥¼ ë¶™ì´ë©´ ìœ„ì ¯ ì „ì²´ ìƒëª…ì£¼ê¸°ì™€ ê´€ë ¨ëœ ë™ì‘ì´ ê¹¨ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, í•¨ìˆ˜ ë‚´ë¶€ì—ì„œë§Œ ë©”ì¸ ì•¡í„°ë¡œ ì „í™˜í•˜ëŠ” ê²ƒ

---

## Challenge
1.	Shiny ìŠ¤í”„ë¼ì´íŠ¸ ì „í™˜ í† ê¸€
    - ContentViewì— ì¼ë°˜ ìŠ¤í”„ë¼ì´íŠ¸ â†” Shiny ìŠ¤í”„ë¼ì´íŠ¸ë¥¼ ì „í™˜í•  ìˆ˜ ìˆëŠ” í† ê¸€ ì¶”ê°€.
2.	í¬ì¼“ëª¬ íƒ€ì… í•„í„°ë§ ì¶”ê°€
    - ê¸°ì¡´ì˜ ì¦ê²¨ì°¾ê¸°/ê²€ìƒ‰ í•„í„° ì™¸ì—, íƒ€ì…ë³„ë¡œ í•„í„°ë§í•˜ëŠ” ê¸°ëŠ¥ ì¶”ê°€.
3.	ìŠ¤í”„ë¼ì´íŠ¸ ì „ì²´ ë³´ê¸° í™”ë©´ êµ¬í˜„
    - ë””í…Œì¼ í™”ë©´ì˜ ìŠ¤í”„ë¼ì´íŠ¸ë¥¼ íƒ­í•˜ë©´ ì—¬ëŸ¬ ì„¸ëŒ€ì˜ ë‹¤ì–‘í•œ ìŠ¤í”„ë¼ì´íŠ¸ë¥¼ ë³´ì—¬ì£¼ëŠ” ìƒˆë¡œìš´ í™”ë©´ìœ¼ë¡œ ì´ë™.
4.	í¬ì¼“ëª¬ ê¸°ìˆ  ëª©ë¡ í‘œì‹œ
    - ë””í…Œì¼ í™”ë©´ í•˜ë‹¨ì— DisclosureGroupì„ ì¶”ê°€í•´ í•´ë‹¹ í¬ì¼“ëª¬ì´ ë°°ìš¸ ìˆ˜ ìˆëŠ” ëª¨ë“  ê¸°ìˆ ë“¤ì„ í‘œì‹œ.
    - ê¸°ìˆ ì˜ íƒ€ì… ì •ë³´ë„ í•¨ê»˜ í‘œì‹œí•˜ë©´ ë³´ë„ˆìŠ¤.
âš™ï¸ ì±Œë¦°ì§€ëŠ” CoreDataì™€ SwiftData ì¤‘ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥í•˜ë©°, ë‘ ë°©ì‹ ëª¨ë‘ ì‹œë„í•´ë„ ì¢‹ìŒ.
ê°ê°ì˜ ì»¤ë°‹ ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¥¼ ë§Œë“¤ì–´ ë¶„ë¦¬ëœ ì‘ì—…ì´ ê°€ëŠ¥í•˜ë©°, ë³‘í•©ì€ í•„ìˆ˜ ì•„ë‹˜.

ì´ê²ƒë„ ë‚˜ì¤‘ì— í•´ë³´ëŠ”ê±¸ë¡œ..