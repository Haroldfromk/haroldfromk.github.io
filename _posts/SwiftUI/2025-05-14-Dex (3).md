---
title: Dex (3)
writer: Harold
date: 2025-5-14 8:33:00 +0800
categories: [Udemy, SwiftUI]
tags: [SwiftUI]

toc: true
toc_sticky: true
---

ì´ì „ ê¸€ì—ì„œ ëª¨ë¸ êµ¬ì¡°ì™€ CodingKeysë¥¼ ì •ë¦¬í–ˆìœ¼ë‹ˆ, ì´ë²ˆì—ëŠ” ì§ì ‘ initì—ì„œ decodingì„ ë” ìì„¸íˆ ì•Œì•„ë³¸ë‹¤.

## ì½”ë“œ ë¶„ì„

ì´ì œ Json êµ¬ì¡°ì™€ í•¨ê»˜ ì½”ë“œë¥¼ ë³´ë©´ì„œ ì•Œì•„ë³´ì

Json êµ¬ì¡°ì˜ ê²½ìš°ë‚˜ë¨¸ì§€ëŠ” ìƒëµí•˜ê³  í•„ìš”í•œ ë¶€ë¶„ë§Œ ê°€ì ¸ì˜¨ë‹¤.

ì½”ë“œ ì—­ì‹œë„ í•„ìš”í•œ ë¶€ë¶„ë§Œ ê°€ì ¸ì˜¤ë„ë¡ í•œë‹¤.

ì´ë•Œ ë‘˜ë‹¤ `//ìƒëµ` ì´ë¼ëŠ” ì£¼ì„ì€ ë¹¼ê³  ì ë„ë¡ í•˜ê² ë‹¤.

### 1. id, name

#### Json êµ¬ì¡°

```json
{
  "id": 1,
  "name": "bulbasaur"
 }
```

#### Code

Json êµ¬ì¡°ìƒ ê°„ë‹¨í•˜ê²Œ Decodingì„ í•  ìˆ˜ ì—†ê¸°ì— Containerë¥¼ ì‚¬ìš©í•´ì•¼í•¨. (JsonDecoder ì‚¬ìš©âŒ)


```swift
enum CodingKeys: CodingKey {
        case id
        case name
}
init(from decoder: any Decoder) throws {
  let container = try decoder.container(keyedBy: CodingKeys.self)       
  id = try container.decode(Int16.self, forKey: .id)
  name = try container.decode(String.self, forKey: .name)
}
```

id, name ëª¨ë‘ CodingKeyì— ìˆëŠ” id, nameìœ¼ë¡œ í•´ê²° ê°€ëŠ¥

### 2. types

#### Json êµ¬ì¡°

```json
{
  "types": [
          {
              "slot": 1,
              "type": {
                  "name": "grass",
                  "url": "https://pokeapi.co/api/v2/type/12/"
              }
          },
          {
              "slot": 2,
              "type": {
                  "name": "poison",
                  "url": "https://pokeapi.co/api/v2/type/4/"
              }
          }
      ]
}
```

#### Code

ìš°ë¦¬ëŠ” typesì•ˆì— ìˆëŠ” typeì˜ nameì´ í•„ìš”í•œ ìƒíƒœ

```swift
enum CodingKeys: CodingKey {
        case types
        
        enum TypeDictionaryKeys: CodingKey {
            case type
            
            enum TypeKeys: CodingKey {
                case name
            }
        }

init(from decoder: any Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        
        var decodedTypes: [String] = []
        var typesContainer = try container.nestedUnkeyedContainer(forKey: .types)
        
        while !typesContainer.isAtEnd {
            // Decode types
            let typesDictionaryContainer = try typesContainer.nestedContainer(keyedBy: CodingKeys.TypeDictionaryKeys.self)
            let typeContainer = try typesDictionaryContainer.nestedContainer(keyedBy: CodingKeys.TypeDictionaryKeys.TypeKeys.self, forKey: .type)
            
            let type = try typeContainer.decode(String.self, forKey: .name)
            decodedTypes.append(type)
        }
        types = decodedTypes
}
```

ìš°ì„  jsonì„ ë³´ë©´ types ë¼ëŠ” ë°°ì—´ì•ˆì— ë”•ì…”ë„ˆë¦¬ê°€ ì¡´ì¬í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.

ì–´ì°¨í”¼ ìš°ë¦¬ëŠ” ë”•ì…”ë„ˆë¦¬ ì „ì²´ë¥¼ ê°€ì ¸ì™€ì„œ ë‹´ëŠ”ê²Œ ì•„ë‹ˆê¸° ë•Œë¬¸ì— [String] ë°°ì—´ì„ ë§Œë“¤ì–´ ì£¼ì—ˆë‹¤.

`var decodedTypes: [String] = []`

[Docs](https://developer.apple.com/documentation/swift/keyeddecodingcontainerprotocol/nestedunkeyedcontainer(forkey:)){:target="_blank"}ë¥¼ ì½ì–´ë³´ë„ë¡ í•˜ì.

- whileì˜ ê²½ìš° 
  - ë°°ì—´ ì•ˆì˜ ê°ì²´ë“¤ì„ í•˜ë‚˜ì”© êº¼ë‚´ì„œ, ê·¸ ì•ˆì˜ íŠ¹ì • ê°’(name)ì„ ì¶”ì¶œí•˜ëŠ” ë£¨í”„
	- ì¶”ì¶œì„ í•œ ê²°ê³¼ëŠ” ì•„ë§ˆë„ `["grass", "poison"]` ì´ëŸ°ì‹ìœ¼ë¡œ ì €ì¥ì´ ë  ê²ƒì´ë‹¤.
- ê°„ë‹¨í•œ ê²°ë¡ 
  -	types: ë°°ì—´ ì•ˆì˜ ë”•ì…”ë„ˆë¦¬ ì•ˆì˜ ë”•ì…”ë„ˆë¦¬ì—ì„œ nameë§Œ ë½‘ê¸°


### 3. stats

#### Json êµ¬ì¡°

```json
{
  "stats": [
          {
              "base_stat": 45,
          },
          {
              "base_stat": 49,
          },
          {
              "base_stat": 49,
          }
      ]
}
```

#### Code

[Docs](https://developer.apple.com/documentation/swift/unkeyeddecodingcontainer/nestedunkeyedcontainer()){:target="_blank"}ëŠ” ì—¬ê¸°

```swift
enum CodingKeys: CodingKey {
        case stats
        
        enum StatDictionaryKeys: CodingKey {
            case baseStat
        }
      }

init(from decoder: any Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        
        var decodedStats: [Int16] = []
        var statsContainer = try container.nestedUnkeyedContainer(forKey: .stats)
        while !statsContainer.isAtEnd {
            let statsDictionaryContainer = try statsContainer.nestedContainer(keyedBy: CodingKeys.StatDictionaryKeys.self)
            let stat = try statsDictionaryContainer.decode(Int16.self, forKey: .baseStat)
            decodedStats.append(stat)
        }

        hp = decodedStats[0]
        attack =  decodedStats[1]
        defense =  decodedStats[2]
        specialAttack =  decodedStats[3]
        specialDefense =  decodedStats[4]
        speed =  decodedStats[5]
}
```

typesì™€ ë¹„ìŠ·í•œ êµ¬ì¡°

ëŒ€ì‹  statsì—ëŠ” 

![Image](https://github.com/user-attachments/assets/327fdbfb-8ed6-48ea-90a0-4a3484133138)

0~5 ê¹Œì§€ ì´ 6ê°œì˜ ë°°ì—´ì´ ì¡´ì¬í•œë‹¤.

ê·¸ ë°°ì—´ì€ ê°ê°ì˜ ëŠ¥ë ¥ì¹˜ ìˆ˜ì¹˜ê°€ ì¡´ì¬í•œë‹¤.

í•˜ì§€ë§Œ êµ³ì´ nameì„ ê°€ì ¸ì˜¬ í•„ìš”ì—†ì´ ìš°ë¦¬ê°€ ì´ë¯¸ 

```swift
let hp: Int16
let attack: Int16
let defense: Int16
let specialAttack: Int16
let specialDefense: Int16
let speed: Int16
```

ì´ëŸ°ì‹ìœ¼ë¡œ ë³€ìˆ˜ë“¤ì„ ë§Œë“¤ì–´ ë‘ì—ˆê¸°ì—

ê° ë°°ì—´ì— í•´ë‹¤í•˜ëŠ” ê°’ë§Œ ë„£ì–´ì£¼ë©´ ëœë‹¤. ê·¸ë˜ì„œ baseStatë§Œ ë””ì½”ë”©í•´ì„œ ê°€ì ¸ì˜¤ëŠ”ê²ƒ.

ê·¸ë¦¬ê³  statsë¼ëŠ” í° ë°°ì—´ì•ˆì— baseStats ë¼ëŠ” ë”•ì…”ë„ˆë¦¬ê°€ ìˆìœ¼ë¯€ë¡œ

- nestedUnkeyedContainer â†’ nestedContainer -> decode ì‘ì—… ì´ë ‡ê²Œ ì§„í–‰ëœë‹¤. 
  - ì´ë•Œ nestedContainer -> decode ì‘ì—…ì€ while ì•ˆì—ì„œ ê°’ì´ ì—†ì„ë•Œê¹Œì§€ ìˆœí™˜
- ê°„ë‹¨í•œ ê²°ë¡ 
  -	stats: ë°°ì—´ ì•ˆì˜ baseStat ê°’ë§Œ ìˆœì„œëŒ€ë¡œ ë½‘ê¸° (key ì—†ì´ ìˆœì„œ ê³ ì •)

- âš ï¸ ì°¸ê³ : stats ë””ì½”ë”© ì‹œ ì£¼ì˜ì 
  -	decodedStats[0] ~ [5]ëŠ” PokeAPIì—ì„œ í•­ìƒ 6ê°œ í•­ëª©(hp, attack, â€¦, speed)ì„ ì œê³µí•œë‹¤ëŠ” ì „ì œí•˜ì— ì‚¬ìš©ëœë‹¤.
  -	í•˜ì§€ë§Œ ë§Œì•½ decodedStats[6] ë“± ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¸ë±ìŠ¤ë¥¼ ì ‘ê·¼í•˜ë ¤ í•˜ë©´ index out of range ì—ëŸ¬ ë°œìƒ.
  -	ë˜í•œ JSON êµ¬ì¡° ìì²´ê°€ ë³€ê²½ë˜ê±°ë‚˜ ëˆ„ë½ë˜ë©´ ë””ì½”ë”© ë„ì¤‘ DecodingErrorê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ.

### 4. sprites

#### Json êµ¬ì¡°

```json
{
  "sprites": {
          "front_default": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png",
          "front_female": null,
          "front_shiny": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/shiny/1.png",
        
          }
}
```

#### Code

```swift
enum CodingKeys: CodingKey {
        case sprites
        
        enum SpriteKeys: String, CodingKey {
            case sprite = "frontDefault"
            case shiny = "frontShiny"
        }
    }

init(from decoder: any Decoder) throws {
    let container = try decoder.container(keyedBy: CodingKeys.self)
    
    let spriteContainer = try container.nestedContainer(keyedBy: CodingKeys.SpriteKeys.self, forKey: .sprites)
    
    sprite = try spriteContainer.decode(URL.self, forKey: .sprite)
    shiny = try spriteContainer.decode(URL.self, forKey: .shiny)
}
```

SpriteëŠ” Swift ë³€ìˆ˜ëª…(`frontDefault`)ê³¼ JSON key(`front_default`)ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, `CodingKeys.SpriteKeys` ì•ˆì—ì„œ `rawValue`ë¥¼ ëª…ì‹œí•˜ì—¬ ì •í™•í•˜ê²Œ ë§¤í•‘í•´ì•¼ í•œë‹¤.

ê·¸ë¦¬ê³  ë‚´ë¶€ê°€ ë”•ì…”ë„ˆë¦¬ê¸°ì— `nestedContainer`ë¥¼ ì‚¬ìš©í•´ì£¼ì—ˆë‹¤.


### 5. ğŸ“¦ nestedContainer vs nestedUnkeyedContainer

| ë©”ì„œë“œ ì´ë¦„               | ìš©ë„                          | JSON êµ¬ì¡° ì˜ˆì‹œ                          |
|--------------------------|-------------------------------|-----------------------------------------|
| `nestedContainer`        | ë”•ì…”ë„ˆë¦¬(JSON ê°ì²´) ì ‘ê·¼ìš©       | `{ "type": { "name": "..." } }`        |
| `nestedUnkeyedContainer` | ë°°ì—´(JSON ë°°ì—´) ì ‘ê·¼ìš©          | `[ { "type": ... }, { "type": ... } ]` |

---

#### ğŸ“Œ í•µì‹¬ ê°œë… ì •ë¦¬
  - **ë”•ì…”ë„ˆë¦¬ â†’ `nestedContainer`**
  - **ë°°ì—´ â†’ `nestedUnkeyedContainer`**
  - ì¤‘ì²© êµ¬ì¡°ì— ë”°ë¼ ì»¨í…Œì´ë„ˆë¥¼ **ê³„ì¸µì ìœ¼ë¡œ ì¤‘ì²©**í•´ì„œ ì‚¬ìš©í•´ì•¼ í•¨

ì˜ˆì‹œ íë¦„:
- `types` êµ¬ì¡°: 
  - ë°°ì—´ â†’ ë”•ì…”ë„ˆë¦¬ â†’ ë”•ì…”ë„ˆë¦¬  
- ì‚¬ìš© íë¦„:
  - `nestedUnkeyedContainer` â†’ `nestedContainer` â†’ `nestedContainer`

---

#### ğŸ§© ìš”ì•½ ì˜ˆì‹œ

```swift
let typesContainer = try container.nestedUnkeyedContainer(forKey: .types)
let typeDictContainer = try typesContainer.nestedContainer(keyedBy: ..., ...)
let typeContainer = try typeDictContainer.nestedContainer(keyedBy: ..., forKey: .type)
```

- ë°°ì—´ â†’ ë”•ì…”ë„ˆë¦¬ â†’ ë”•ì…”ë„ˆë¦¬ êµ¬ì¡° íŒŒì‹±

---

ì¤‘ì²©ëœ JSON êµ¬ì¡°ëŠ” ë°°ì—´ì¸ì§€ ë”•ì…”ë„ˆë¦¬ì¸ì§€ì— ë”°ë¼ ì ‘ê·¼ ë°©ì‹ì´ ë‹¬ë¼ì§„ë‹¤.
container, nestedUnkeyedContainer, nestedContainerë¥¼ JSON êµ¬ì¡°ì— ë§ê²Œ ê³„ì¸µì ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ì ì„ ê¸°ì–µí•˜ì.