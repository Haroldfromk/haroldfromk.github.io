---
title: Final (23)
writer: Harold
date: 2024-06-23 01:00
categories: [캠프, TheLast]
tags: []
toc: true
toc_sticky: true
---

## 리뷰 상세 페이지 이미지 확대 기능 추가

우선 UIImageView의 extension을 만들어 주었다.

```swift
import UIKit
import Kingfisher

extension UIImageView {
    private struct AssociatedKeys {
        static var urlKey = "urlKey"
    }
    Add commentMore actions
    var imageURL: URL? {
        get {
            return objc_getAssociatedObject(self, &AssociatedKeys.urlKey) as? URL
        }
        set {
            objc_setAssociatedObject(self, &AssociatedKeys.urlKey, newValue, .OBJC_ASSOCIATION_RETAIN_NONATOMIC)
        }
    }
}
```
이 코드는 UIImageView에 직접 저장할 수 없는 값을 동적으로 추가하기 위해 런타임 속성(Associated Object) 을 사용하는 확장이다.
imageURL이라는 커스텀 속성을 UIImageView에 추가하고, 이미지에 연결된 URL 정보를 저장할 수 있게 만든다. 이건 GPT의 도움을 받아서 만들었다.

---

## DetailedReviewViewController 변경사항 요약

### 1. 사용자 정보 관련 기능 추가

**변경 전**  
- 리뷰 데이터(`ReviewModel`)만 처리  
- 리뷰 작성자에 대한 **닉네임, 프로필 이미지** 등은 미포함

**변경 후**  
- `var userInfo: UserModel?` 프로퍼티 추가  
- 사용자 관련 프로퍼티 (`userProfile`, `userNickname`)와 뷰 (`userProfileImage`, `userNicknameLabel`) 추가  
- `setUserData(info:)` 함수로 사용자 정보를 설정하고 뷰에 반영

**도입 목적**  
리뷰 상세에서 작성자의 프로필 이미지 및 닉네임을 보여주기 위함

---

### 2. 이미지 클릭 시 전체 화면 보기 추가

**변경 전**  
- 이미지를 보여주기만 하고 클릭 액션 없음

**변경 후**  
- 단일 이미지 및 스크롤 이미지 모두에 `UITapGestureRecognizer` 추가  
- `@objc func imageTapped(_:)` 메서드를 통해 전체화면 이미지 뷰어 (`FullscreenPageViewController`) 표시

**도입 목적**  
리뷰 이미지를 클릭하면 전체 화면으로 확인 가능하도록 UX 개선

---

### 3. 리뷰 생성일 표시 기능 추가

**변경 전**  
- 리뷰의 작성 시점(날짜)이 표시되지 않음

**변경 후**  
- `createdAt` 프로퍼티와 `createdAtLabel` 뷰 추가  
- `timestampToString(value:)` 함수로 Firebase의 `Timestamp`를 포맷팅  
- UI에 날짜 텍스트 표시

**도입 목적**  
리뷰의 시점을 명확히 표시해 사용자 신뢰도 향상

---

### 4. 전반적인 UI 개선

**변경 내용**  
- `introLabel` ("리뷰 전체보기") 추가  
- 폰트 크기 및 정렬 다수 변경 (가독성 향상)  
- 오토레이아웃 정리 및 재구성  
- `storeNameLabel` 폰트를 Bold로 변경  
- `reviewTitleLabel`의 `numberOfLines` 설정으로 줄바꿈 허용

**도입 목적**  
UI의 정보 구조와 시각적 완성도 향상

---

### 5. 코드 리팩토링 및 안정성 개선

**변경 내용**  
- `setUserData()` 메서드 분리  
- optional 바인딩 안전성 보완  
- `deinit`에서 추가 프로퍼티 초기화 및 다운로드 취소 (`userProfileImage`, `imageView` 등)

**도입 목적**  
메모리 누수 방지 및 유지보수성 향상

---

## 결론

이번 변경은 리뷰 상세 화면을 **사용자 정보 포함**, **날짜 표시**, **이미지 전체 화면 지원** 등으로 시각적, 기능적으로 업그레이드한 개선이다.  
이를 통해 사용자는 보다 **신뢰성 높은 리뷰**를 확인할 수 있고, 앱의 전반적인 UI/UX 완성도도 높아졌다.