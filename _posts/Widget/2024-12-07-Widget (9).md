---
title: WidgetKit (9)
writer: Harold
date: 2024-12-07 00:13
categories: [WidgetKit, SwiftCal, CoreData]
tags: []

toc: true
toc_sticky: true
---

## Calendarì— TapGesture ì¶”ê°€

í˜„ì¬ëŠ” ìº˜ë¦°ë”ì— ì–´ë– í•œ ì•¡ì…˜ë„ ì ìš©ì´ ë˜ì–´ìˆì§€ ì•Šë‹¤.

ì´ì   ìº˜ë¦°ë”ë¥¼ íƒ­í–ˆì„ë•Œì˜ Gestureë¥¼ ì¶”ê°€í•´ ë³´ë„ë¡ í•œë‹¤.

`onTapGesture` Modifierë¥¼ ì‚¬ìš©í•œë‹¤.

```swift
.onTapGesture {
    if day.date!.dayInt <= Date().dayInt {
        day.didStudy.toggle()
        
        do {
            try viewContext.save()
            print("ğŸ‘† \(day.date!.dayInt) now studied.")
        } catch {
            print("Failed to save context")
        }
        
    } else {
        print("Can't study in the future!")
    }
}
```

í˜„ì¬ì¼ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ê³¼ê±°ë§Œ ì ìš©ì´ ë˜ê³  ë¯¸ë˜ëŠ” ì ìš©ì´ ë˜ì§€ ì•Šê²Œ í•œë‹¤.

ê·¸ë¦¬ê³  ê°’ì´ ë³€í™”ë¥¼ í•˜ë©´ ë°˜ë“œì‹œ `viewContext.save()`ë¥¼ í†µí•´ ì €ì¥ í•´ì¤˜ì•¼í•œë‹¤.

![Dec-07-2024 07-12-51](https://github.com/user-attachments/assets/9108fb7e-2a9e-4360-b656-43898da05e3d){: width="50%" height="50%"} 

í˜„ì¬ ê¸€ì„ ì‘ì„±í•˜ëŠ” ì‹œì ì€ 12ì›” 7ì¼ ì´ê¸°ì— 7ì¼ê¹Œì§€ë§Œ ë‚˜ì˜¨ë‹¤ ê·¸ ì´í›„ì—ëŠ” Consoleì— í”„ë¦°íŠ¸ ëœë‹¤.

```text
Can't study in the future!
Can't study in the future!
Can't study in the future!
Can't study in the future!
```

## StreakView ë§Œë“¤ê¸°

ê³µë¶€ë¥¼ íë‹¹íë‹¹ í•˜ë£¨ ê±¸ëŸ¬ì„œ í•˜ëŠ”ê²Œì•„ë‹ˆë¼ ì—°ë‹¬ì•„ì„œ í•˜ëŠ”ê²½ìš°ì— ë­”ê°€ ê°•ì¡°ë¥¼ í•˜ê¸°ìœ„í•œ Viewë¡œ ìƒê°ì„ í•˜ë©´ ë ë“¯ í•˜ë‹¤.

![CleanShot 2024-12-07 at 07 17 48](https://github.com/user-attachments/assets/7e1bd024-a00b-467d-8f97-d6e8ed908797){: width="50%" height="50%"} 


```swift
@State private var streakValue = 0
var body: some View {
    VStack {
        Text("20")
            .font(.system(size: 200, weight: .semibold, design: .rounded))
            .foregroundStyle(streakValue > 0 ? .orange : .pink)
        Text("Current Streak")
            .font(.title2)
            .bold()
            .foregroundStyle(.secondary)
    }
    .offset(y: -50)
}
```

### StreakValue ê³„ì‚° í•¨ìˆ˜ êµ¬í˜„í•˜ê¸°

ê·¸ì „ì— Coredataë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” FetchRequestë¥¼ ì—¬ê¸°ë‹¤ê°€ë„ êµ¬í˜„í•´ì¤€ë‹¤.

```swift
@FetchRequest(
    sortDescriptors: [NSSortDescriptor(keyPath: \Day.date, ascending: true)],
    predicate: NSPredicate(format: "(date >= %@) AND (date <= %@)",
                            Date().startOfMonth as CVarArg,
                            Date().endOfMonth as CVarArg))
private var days: FetchedResults<Day>
```

[ì´ì „ê¸€](https://haroldfromk.github.io/posts/Widget-(8)/){:target="_blank"}ì—ì„œëŠ” `Date().startOfCalendarWithPrefixDays`ë¡œ ë˜ì–´ìˆì–´ì„œ ë‹¬ë ¥ì˜ 1ì¼ì´ ì¼ìš”ì¼ì´ ì•„ë‹Œê²½ìš° ê·¸ ì•ì˜ ê³µë°±ì„ ê³„ì‚°í•˜ê¸° ìœ„í•¨ì´ì—ˆëŠ”ë°, ì—¬ê¸° Viewì—ì„œëŠ” ë‹¨ìˆœíˆ í˜„ì¬ ë‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ ì—°ì†ìœ¼ë¡œ ê³µë¶€í•œ ì¼ì´ ìˆëŠ”ì§€ë¥¼ ê³„ì‚°ì„ í•˜ê¸° ìœ„í•¨ì´ë¼ ìœ„ì™€ ê°™ì´ ì‘ì„±ì„ í•œë‹¤.

```swift
.onAppear {
    streakValue = calculateStreakValue()
}


func calculateStreakValue() -> Int {
    guard !days.isEmpty else { return 0 }
    
    let nonfutureDays = days.filter { $0.date!.dayInt <= Date().dayInt }
    
    var streakCount = 0
    
    for day in nonfutureDays.reversed() {
        if day.didStudy {
            streakCount += 1
        } else {
            if day.date!.dayInt != Date().dayInt {
                break
            }
        }
    }
    
    return streakCount
}
```

í•´ë‹´ í•¨ìˆ˜ë¥¼ ìì„¸íˆ ì•Œì•„ë³´ë©´

1. **Core Data ê°’ í™•ì¸**
   - `guard` ë¬¸ì„ í†µí•´ Core Dataì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆì„ ê²½ìš° `0`ì„ ë°˜í™˜í•œë‹¤.
     - ì˜ˆì™¸ ì²˜ë¦¬ë¡œ ê°’ì´ ì—†ì„ ë•Œ ì—°ì† í•™ìŠµ ì¼ìˆ˜ë¥¼ `0`ìœ¼ë¡œ ê°„ì£¼.

2. **ê³¼ê±° ë°ì´í„° í•„í„°ë§**
   - `nonfutureDays`ë¥¼ ì‚¬ìš©í•´ **ì˜¤ëŠ˜(`Date()`) ì´ì „ ë˜ëŠ” ê°™ì€ ë‚ ì§œ**ì˜ ë°ì´í„°ë§Œ í•„í„°ë§í•œë‹¤.
     - ì˜ˆ: ì˜¤ëŠ˜ì´ 12ì›” 7ì¼ì´ë©´, 1ì¼ë¶€í„° 7ì¼ê¹Œì§€ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

3. **ì´ˆê¸°í™”**
   - ì—°ì† í•™ìŠµ ì¼ ìˆ˜ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ `streakCount`ë¥¼ ìƒì„±í•˜ê³  `0`ìœ¼ë¡œ ì´ˆê¸°í™”.

4. **ì—­ìˆœ ë°˜ë³µ**
   - `reversed`ë¥¼ ì‚¬ìš©í•´ ê°€ì¥ ìµœê·¼ ë‚ ì§œë¶€í„° ê³¼ê±°ë¡œ íƒìƒ‰.
     - ì˜ˆ: `1~7` â†’ `7~1`ë¡œ ë³€ê²½í•˜ì—¬ ë°˜ë³µë¬¸ ì‹¤í–‰.

5. **í•™ìŠµ ì—¬ë¶€ í™•ì¸**
   - `if day.didStudy`: í•´ë‹¹ ë‚ ì§œì— í•™ìŠµí–ˆëŠ”ì§€ í™•ì¸.
     - í•™ìŠµí–ˆë‹¤ë©´ `streakCount`ë¥¼ `1` ì¦ê°€.

6. **í•™ìŠµí•˜ì§€ ì•Šì€ ê²½ìš°**
   - `else` ë¸”ë¡ì—ì„œ í•™ìŠµí•˜ì§€ ì•Šì•˜ì„ ê²½ìš°:
     - **ì˜¤ëŠ˜ ë‚ ì§œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°**:
       - ì—°ì† í•™ìŠµì´ ì¤‘ë‹¨ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³  `break`ë¡œ ë°˜ë³µë¬¸ ì¢…ë£Œ.
     - **ì˜¤ëŠ˜ ë‚ ì§œì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°**:
       - í•™ìŠµì„ ì¤‘ë‹¨í•˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³  ê³¼ê±° ë°ì´í„° íƒìƒ‰ì„ ê³„ì† ì§„í–‰.

ì‹¤í–‰ì— ì•ì„œ Viewë¥¼ í™•ì¸í•´ì•¼í•˜ë‹ˆ TabViewë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.

### í•™ìŠµí•˜ì§€ ì•Šì€ ê²½ìš°ì— ëŒ€í•´ì„œ

`else` ë¸”ë¡ì—ì„œëŠ” í•´ë‹¹ ë‚ ì§œì— í•™ìŠµì„ í•˜ì§€ ì•Šì€ ê²½ìš°ë¥¼ ì²˜ë¦¬í•œë‹¤. ì´ë•Œ ì¡°ê±´ì— ë”°ë¼ ë‘ ê°€ì§€ ìƒí™©ìœ¼ë¡œ ë‚˜ë‰˜ì–´ì§„ë‹¤.

---

#### 1. **ì˜¤ëŠ˜ ë‚ ì§œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê²½ìš°**
   - ê³¼ê±°ì— í•™ìŠµí•˜ì§€ ì•Šì€ ë‚ ì§œê°€ ë‚˜íƒ€ë‚œ ê²½ìš°, ì´ëŠ” ì—°ì† í•™ìŠµì´ ì¤‘ë‹¨ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•œë‹¤.
   - ì´ ìƒí™©ì—ì„œëŠ” `break` ë¬¸ì„ ì‚¬ìš©í•´ ë°˜ë³µë¬¸ì„ ì¦‰ì‹œ ì¢…ë£Œí•˜ê³  ë” ì´ìƒ ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
   
**ì˜ˆì‹œ**  
í˜„ì¬ ë‚ ì§œê°€ **12ì›” 7ì¼**ì´ê³ , ë‹¤ìŒê³¼ ê°™ì€ í•™ìŠµ ê¸°ë¡ì´ ìˆë‹¤ê³  ê°€ì •

| ë‚ ì§œ         | í•™ìŠµ ì—¬ë¶€ (`didStudy`)    |
|--------------|---------------------------|
| 12ì›” 7ì¼     | âŒ (false)                |
| 12ì›” 6ì¼     | âœ… (true)                 |
| 12ì›” 5ì¼     | âœ… (true)                 |
| 12ì›” 4ì¼     | âŒ (false)                |

- íƒìƒ‰ ìˆœì„œ: `12ì›” 7ì¼` â†’ `12ì›” 6ì¼` â†’ `12ì›” 5ì¼` â†’ `12ì›” 4ì¼`
- **12ì›” 7ì¼**: í•™ìŠµí•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ `streakCount` ê³„ì‚°ì€ ì§„í–‰ë˜ì§€ ì•ŠìŒ.
- **12ì›” 6ì¼**: `didStudy == true`, `streakCount += 1`.
- **12ì›” 5ì¼**: `didStudy == true`, `streakCount += 1`.
- **12ì›” 4ì¼**: í•™ìŠµí•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì—°ì† í•™ìŠµì´ ì¤‘ë‹¨ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³  **`break`**.

ìµœì¢…ì ìœ¼ë¡œ, `streakCount = 2`ê°€ ë°˜í™˜ëœë‹¤.

#### 2. **ì˜¤ëŠ˜ ë‚ ì§œì™€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°**
   - í•™ìŠµí•˜ì§€ ì•Šì€ ë‚ ì§œê°€ ì˜¤ëŠ˜ì´ë¼ë©´, ì´ëŠ” ì—°ì† í•™ìŠµì˜ ì¤‘ë‹¨ìœ¼ë¡œ ê°„ì£¼í•˜ì§€ ì•ŠëŠ”ë‹¤.
   - ì˜¤ëŠ˜ í•™ìŠµí•˜ì§€ ì•Šì•˜ë”ë¼ë„ ê³¼ê±° ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ì—¬ ì—°ì† í•™ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ë°˜ë³µë¬¸ì„ ê³„ì† ì§„í–‰í•œë‹¤.

**ì˜ˆì‹œ**  
í˜„ì¬ ë‚ ì§œê°€ **12ì›” 7ì¼**ì´ê³ , ë‹¤ìŒê³¼ ê°™ì€ í•™ìŠµ ê¸°ë¡ì´ ìˆë‹¤ê³  ê°€ì •

| ë‚ ì§œ         | í•™ìŠµ ì—¬ë¶€ (`didStudy`)    |
|--------------|---------------------------|
| 12ì›” 7ì¼     | âŒ (false)                |
| 12ì›” 6ì¼     | âœ… (true)                 |
| 12ì›” 5ì¼     | âœ… (true)                 |
| 12ì›” 4ì¼     | âŒ (false)                |

- íƒìƒ‰ ìˆœì„œ: `12ì›” 7ì¼` â†’ `12ì›” 6ì¼` â†’ `12ì›” 5ì¼` â†’ `12ì›” 4ì¼`
- **12ì›” 7ì¼**: ì˜¤ëŠ˜ í•™ìŠµí•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ `streakCount` ê³„ì‚°ì€ ì§„í–‰ë˜ì§€ ì•Šì§€ë§Œ, **ì—°ì† í•™ìŠµ ì¤‘ë‹¨ìœ¼ë¡œ ê°„ì£¼í•˜ì§€ ì•ŠìŒ**.
  - ë°˜ë³µë¬¸ì€ ê³„ì† ì§„í–‰.
- **12ì›” 6ì¼**: `didStudy == true`, `streakCount += 1`.
- **12ì›” 5ì¼**: `didStudy == true`, `streakCount += 1`.
- **12ì›” 4ì¼**: í•™ìŠµí•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì—°ì† í•™ìŠµì´ ì¤‘ë‹¨ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³  **`break`**.

ìµœì¢…ì ìœ¼ë¡œ, `streakCount = 2`ê°€ ë°˜í™˜ëœë‹¤.

---

**ê²°ë¡ **
- ì˜¤ëŠ˜ ë‚ ì§œì— í•™ìŠµí•˜ì§€ ì•Šì•˜ë‹¤ë©´ `streakCount`ì—ëŠ” ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šì§€ë§Œ, ê³¼ê±°ì˜ í•™ìŠµ ê¸°ë¡ì„ ê³„ì† íƒìƒ‰í•˜ì—¬ ì—°ì† í•™ìŠµì„ ê³„ì‚°í•œë‹¤.
- ì´ ë…¼ë¦¬ëŠ” ì˜¤ëŠ˜ì´ ì§€ë‚˜ê¸° ì „ê¹Œì§€ í•™ìŠµí•˜ì§€ ì•Šì€ ìƒíƒœë¥¼ í—ˆìš©í•˜ë©°, ê³¼ê±° ê¸°ë¡ì—ë§Œ ì˜í–¥ì„ ì¤€ë‹¤.

---

```swift
var body: some Scene {
    WindowGroup {
        TabView {
            CalendarView()
                .tabItem {
                    Label("Calendar", systemImage: "calendar")
                }
            StreakView()
                .tabItem {
                    Label("Streak", systemImage: "swift")
                }
        }
            .environment(\.managedObjectContext, persistenceController.container.viewContext)
    }
}
```

í˜„ì¬ tabItemì€ Deprecated ë  ì˜ˆì •ì´ë¼ê³  í•œë‹¤.

```swift
var body: some Scene {
    WindowGroup {
        TabView {
            Tab("Calendar", systemImage: "calendar") {
                CalendarView()
            }
            Tab("Streak", systemImage: "swift") {
                StreakView()
            }
        }
        .environment(\.managedObjectContext, persistenceController.container.viewContext)
    }
}
```

ì´ì   ì´ë ‡ê²Œ í•˜ë„ë¡ í•˜ì.

[TabView](https://developer.apple.com/documentation/swiftui/tabview){:target="_blank"} Docsì— ì˜ˆì‹œê°€ ìˆë‹¤.

![Dec-07-2024 07-33-24](https://github.com/user-attachments/assets/e52cb8b3-3c92-4304-8047-30bc20a6658b){: width="50%" height="50%"} 

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤

í˜„ì¬ ê¸°ì¤€ìœ¼ë¡œ ì–´ì œê¹Œì§€ í•œê²Œ ì—†ë‹¤ë©´ ê³¼ê±°ì— ë©°ì¹ ì„ í–ˆì–´ë„ ì—°ì†ì€ ëŠê¸°ê²Œ ëœë‹¤.

ì˜¤ëŠ˜ì€ ê°œì¸ì‚¬ì •ìœ¼ë¡œ ì—¬ê¸°ê¹Œì§€...